From 4cd647cfcb9afaefed3b7587860e28811de25ffc Mon Sep 17 00:00:00 2001
From: Vadim Pasternak <vadimp@nvidia.com>
Date: Thu, 13 Jan 2022 18:32:19 +0200
Subject: [PATCH mlxsw/net-next 1/1] TMP: Debug

---
 drivers/net/ethernet/mellanox/mlxsw/minimal.c | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/mellanox/mlxsw/minimal.c b/drivers/net/ethernet/mellanox/mlxsw/minimal.c
index 599d6cc0f..cdaa0bb5c 100644
--- a/drivers/net/ethernet/mellanox/mlxsw/minimal.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/minimal.c
@@ -241,11 +241,13 @@ mlxsw_m_port_create(struct mlxsw_m *mlxsw_m, u8 slot_index, u16 local_port,
 	struct mlxsw_m_port_mapping *port_mapping;
 	struct mlxsw_m_port *mlxsw_m_port;
 	struct net_device *dev;
+	u8 module_offset;
 	int err;
 
+	module_offset = mlxsw_m->line_cards[slot_index]->module_offset;
 	err = mlxsw_core_port_init(mlxsw_m->core, local_port, slot_index,
-				   module + 1, false, 0, false, 0,
-				   mlxsw_m->base_mac,
+				   module + 1 + module_offset, false, 0, false,
+				   0, mlxsw_m->base_mac,
 				   sizeof(mlxsw_m->base_mac));
 	if (err) {
 		dev_err(mlxsw_m->bus_info->dev, "Port %d: Failed to init core port\n",
@@ -272,7 +274,7 @@ mlxsw_m_port_create(struct mlxsw_m *mlxsw_m, u8 slot_index, u16 local_port,
 	 * multiplied by maximum modules number, which could be found on a line
 	 * card.
 	 */
-	mlxsw_m_port->module_offset = mlxsw_m->line_cards[slot_index]->module_offset;
+	mlxsw_m_port->module_offset = module_offset;
 
 	dev->netdev_ops = &mlxsw_m_port_netdev_ops;
 	dev->ethtool_ops = &mlxsw_m_port_ethtool_ops;
-- 
2.20.1

